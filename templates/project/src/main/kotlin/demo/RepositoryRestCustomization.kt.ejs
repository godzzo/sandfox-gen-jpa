package <%= options.package %>

import <%= options.package %>.domain.*
import org.slf4j.LoggerFactory
import org.springframework.data.rest.core.config.RepositoryRestConfiguration
import org.springframework.data.rest.webmvc.config.RepositoryRestConfigurer
import org.springframework.stereotype.Component
import org.springframework.data.rest.core.event.ValidatingRepositoryEventListener
import org.springframework.beans.factory.annotation.Autowired
import org.springframework.validation.Validator

@Component
class RepositoryRestCustomization : RepositoryRestConfigurer {
    private val log = LoggerFactory.getLogger(RepositoryRestCustomization::class.java)

    init {
        println("RepositoryRestCustomization: INIT")
        log.warn("configureRepositoryRestConfiguration: INIT")

    }

    override fun configureRepositoryRestConfiguration(config: RepositoryRestConfiguration?) {
        println("RepositoryRestCustomization: CALLED")
        log.warn("configureRepositoryRestConfiguration: CALLED")

        config?.exposeIdsFor(<% 
tables.forEach((table, idx) => { 
%>
            <%= table.camelName %>::class.java<%if (idx<tables.length-1) {%>,<%}%><%
});%>
        )
    }

    @Autowired
    private val validator: Validator? = null

    override fun configureValidatingRepositoryEventListener(
            validatingListener: ValidatingRepositoryEventListener
    ) {
        validatingListener.addValidator("beforeCreate", validator)
        validatingListener.addValidator("beforeSave", validator)
    }
}
