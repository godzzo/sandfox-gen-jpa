import { Controller, Get, Query, Param, ParseIntPipe, Body, Post } from '@nestjs/common';

import { InsertResult, DeleteResult } from 'typeorm';

import { <%= table.camelName %>Service } from './<%= table.periodName %>.service';
import { <%= table.camelName %> } from './<%= table.periodName %>.entity';


@Controller('<%= table.name %>')
export class <%= table.camelName %>Controller {
	constructor(private readonly service: <%= table.camelName %>Service) {}

	@Get()
	async findAll(): Promise<<%= table.camelName %>[]> {
		const items = await this.service.findAll();
		
		return items;
	}

	@Get("find")
	async find(@Query() params): Promise<<%= table.camelName %>[]> {
		console.log(params);

		const items = await this.service.find(params);
		
		return items;
	}

	@Get("findAndCount")
	async findAndCount(@Query() params): Promise<[<%= table.camelName %>[], number]> {
		console.log(params);

		const [items, count] = await this.service.findAndCount(params);
		
		return {items, count};
	}

	@Get('get/:id')
	async get(@Param('id', new ParseIntPipe()) id): Promise<<%= table.camelName %>[]> {
		console.log(id);

		const items = await this.service.find({id: id});
		
		return items;
	}

	@Get("insert")
	async insert(@Query() params): Promise<InsertResult> {
		return await this.service.insert(params);
	}

	@Get("save")
	async save(@Query() params): Promise<<%= table.camelName %>> {
		console.log(params);

		return await this.service.save(params);
	}

	@Get("create")
	async create(@Query() params): Promise<InsertResult> {
		return await this.service.insert(params);
	}

	@Post('modify')
	async modify(@Body() params): Promise<<%= table.camelName %>> {
		console.log(params);

		return await this.service.save(params);
	}

	@Get("delete")
	async delete(@Query() params): Promise<DeleteResult> {
		console.log(params);
		
		return await this.service.delete(parseInt(params.id));
	}
}
